{% extends "base.html" %}
{% block title %}Progress Results - FSL Learning Platform{% endblock %}
{% block content %}

<!-- Enhanced Header Section -->
<section class="section animate-fade-in-up">
  <div class="container text-center">
    <h1 style="font-size:3rem;font-weight:900;margin-bottom:1rem;color:var(--ink);">üìà Progress Results</h1>
    <p class="muted" style="font-size:1.25rem;max-width:80ch;margin:0 auto;color: var(--white);
  text-shadow: 2px 2px 8px rgba(0,0,0,0.8), 1px 1px 3px rgba(0,0,0,0.9);">
      Track your Filipino Sign Language learning journey and view detailed performance analytics
    </p>
  </div>
</section>

<section class="section">
  <div class="container">
    <!-- RESULTS PANEL -->
    <div class="card animate-fade-in-up">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
        <h2 style="margin:0;color:var(--primary);font-size:1.5rem;">üìä Learning Analytics</h2>
        <span class="pill success">View Results</span>
      </div>
      <p class="muted" style="margin-bottom:2rem;">Monitor your progress, view detailed statistics, and track improvements over time.</p>



      <!-- Recent Sessions -->
      <div class="card">
        <h3 style="color:var(--secondary);margin-bottom:1rem;">üïê Recent Sessions</h3>
        <div id="recentSessions" style="max-height:300px;overflow-y:auto;">
          <div style="text-align:center;padding:2rem;color:var(--neutral-500);">
            No recent sessions available
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Progress Section -->
<section class="section" style="background:var(--neutral-50);">
  <div class="container text-center">
    <h2 class="animate-fade-in-up" style="color:var(--primary);margin-bottom:2rem;">Keep up the great work!</h2>
    <div class="animate-fade-in-up animate-delay-1">
      <a class="btn" href="{{ url_for('home') }}" style="margin-right:1rem;background:var(--primary);"> <- Back</a>
      <a class="btn btn-outline" href="{{ url_for('activity') }}" style="background:var(--accent);color:white;border-color:var(--accent);">üéØ Practice Now</a>
    </div>
  </div>
</section>

<script>
  // Load user progress data
  async function loadProgressData(){
    try {
      // Load practice session results from localStorage
      const practiceSessions = JSON.parse(localStorage.getItem('fslPracticeSessions') || '[]');

      // Calculate statistics from practice session data
      let totalSessions = practiceSessions.length;
      let totalCorrect = 0;
      let totalSessionsCount = 0;

      practiceSessions.forEach(session => {
        totalSessionsCount++;
        if (session.correct) totalCorrect++;
      });

      const avgAccuracy = totalSessionsCount > 0 ? Math.round((totalCorrect / totalSessionsCount) * 100) : 0;



      // Practice History section is now handled by the Recent Sessions below

      // Generate recent sessions with current dates (in real app, this would come from backend)
      const currentDate = new Date();
      const sampleSessions = [
        {
          date: new Date(currentDate.getTime() - 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          phrase: 'good morning',
          accuracy: 85,
          status: 'correct'
        },
        {
          date: new Date(currentDate.getTime() - 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          phrase: 'thank you',
          accuracy: 72,
          status: 'incorrect'
        },
        {
          date: new Date(currentDate.getTime() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          phrase: 'hello',
          accuracy: 90,
          status: 'correct'
        }
      ];



      // Update recent sessions
      const sessionsContainer = document.getElementById('recentSessions');
      sessionsContainer.innerHTML = '';

      if (practiceSessions.length === 0) {
        sessionsContainer.innerHTML = '<div style="text-align:center;padding:2rem;color:var(--neutral-500);">No practice sessions yet</div>';
      } else {
        practiceSessions.slice(0, 10).forEach((session, index) => {
          const sessionDiv = document.createElement('div');
          sessionDiv.style.cssText = `
            display:flex;justify-content:space-between;align-items:center;padding:1rem;
            border-bottom:1px solid var(--neutral-200);margin-bottom:0.5rem;
          `;

          const date = new Date(session.date).toLocaleDateString();
          const statusColor = session.correct ? 'var(--success)' : 'var(--error)';
          const statusIcon = session.correct ? '‚úÖ' : '‚ùå';
          const confidence = Math.round((session.confidence || 0) * 100);

          sessionDiv.innerHTML = `
            <div>
              <div style="font-weight:600;">${session.phrase.charAt(0).toUpperCase() + session.phrase.slice(1)}</div>
              <div style="font-size:0.75rem;color:var(--neutral-500);">${date} ‚Ä¢ ${session.mode} mode</div>
            </div>
            <div style="text-align:right;">
              <div style="font-weight:600;color:${statusColor};">${statusIcon} ${confidence}%</div>
            </div>
          `;

          sessionsContainer.appendChild(sessionDiv);
        });
      }

    } catch (error) {
      console.error('Error loading progress data:', error);
    }
  }



  // Load data when page loads
  document.addEventListener('DOMContentLoaded', loadProgressData);
</script>

{% endblock %}
