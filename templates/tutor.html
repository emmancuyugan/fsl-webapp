{% extends "base.html" %}
{% block title %}Tutor Mode - FSL Learning Platform{% endblock %}
{% block content %}

<!-- Enhanced Header Section -->
<section class="section animate-fade-in-up">
  <div class="container text-center">
    <h1 style="font-size:3rem;font-weight:900;margin-bottom:1rem;color:var(--ink);">Learning Mode</h1>
    <p class="muted" style="font-size:1.25rem;max-width:80ch;margin:0 auto;color: var(--white);
  text-shadow: 2px 2px 8px rgba(0,0,0,0.8), 1px 1px 3px rgba(0,0,0,0.9);">
      Learn Filipino Sign Language step-by-step with detailed video tutorials and guided instructions
    </p>
  </div>
</section>

<section class="section">
  <div class="container">
    <!-- TUTOR PANEL -->
    <div class="card animate-fade-in-up">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
        <h2 style="margin:0;color:var(--primary);font-size:1.5rem;">ðŸ“š Learn Step-by-Step</h2>
      </div>
      <p class="muted" style="margin-bottom:2rem;">Choose a phrase to learn. Watch the video tutorial and follow the detailed steps.</p>

      <div id="phraseButtons" class="grid grid-3" style="gap:0.75rem;margin-bottom:2rem;"></div>

      <div class="video-wrap animate-fade-in-up" style="margin-bottom:1.5rem;" onmouseover="this.style.transform='none'">
        <video id="teachVideo" controls poster="{{ url_for('static', filename='img/logo.jpg') }}"></video>
        <span class="badge">ðŸ“– Tutorial Video</span>
      </div>

      <div style="background:var(--neutral-50);padding:1.5rem;border-radius:var(--radius-lg);">
        <h4 style="color:var(--secondary);margin-bottom:1rem;">ðŸ“‹ Learning Steps</h4>
        <ol id="teachSteps" style="margin:0;padding-left:1.5rem;"></ol>
      </div>
    </div>
  </div>
</section>

<!-- Progress Section -->
<section class="section" style="background:var(--neutral-50);">
  <div class="container text-center">
    <h2 class="animate-fade-in-up" style="color:var(--primary);margin-bottom:2rem;">Ready to Test Your Learnings?</h2>
    <div class="animate-fade-in-up animate-delay-1">
      <a class="btn" href="{{ url_for('home') }}" style="margin-right:1rem;background:var(--primary);"> <- Back</a>
      <a class="btn btn-outline" href="{{ url_for('activity') }}" style="background:var(--accent);color:white;border-color:var(--accent);">Activity -></a>
    </div>
  </div>
</section>

<script>
  const PHRASES = [];
  const phraseButtons = document.getElementById("phraseButtons");
  const teachVideo = document.getElementById("teachVideo");
  const teachSteps = document.getElementById("teachSteps");

  // init
  fetch("/api/phrases").then(r=>r.json()).then(d=>{
    d.phrases.forEach(p=>{
      PHRASES.push(p);
      // tutor buttons
      const b = document.createElement("button");
      b.className = "btn btn-outline";
      b.textContent = p.charAt(0).toUpperCase() + p.slice(1);
      b.onclick = () => loadTeach(p);
      phraseButtons.appendChild(b);
    });
  });

  // tutor loader
  async function loadTeach(p){
    const res = await fetch(`/api/teach?phrase=${encodeURIComponent(p)}`).then(r=>r.json());

    // Special handling for hello phrase - randomize video selection
    if(p.toLowerCase() === "hello") {
      const helloVideos = [
        "/static/video/hello/Hello.mp4",
        "/static/video/hello/Hello1.mp4",
        "/static/video/hello/Hello2.mp4",
        "/static/video/hello/Hello3.mp4",
        "/static/video/hello/Hello4.mp4",
        "/static/video/hello/Hello5.mp4"
      ];
      const randomVideo = helloVideos[Math.floor(Math.random() * helloVideos.length)];
      teachVideo.src = randomVideo;
    }
    // Special handling for good morning phrase - randomize video selection
    else if(p.toLowerCase() === "good morning") {
      const goodMorningVideos = [
        "/static/video/goodmorning/goodmorning.mp4",
        "/static/video/goodmorning/goodmorning1.mp4",
        "/static/video/goodmorning/goodmorning2.mp4",
        "/static/video/goodmorning/goodmorning3.mp4",
        "/static/video/goodmorning/goodmorning4.mp4",
        "/static/video/goodmorning/goodmorning5.mp4",
        "/static/video/goodmorning/goodmorning6.mp4",
        "/static/video/goodmorning/goodmorning7.mp4",
        "/static/video/goodmorning/goodmorning8.mp4",
        "/static/video/goodmorning/goodmorning9.mp4",
        "/static/video/goodmorning/goodmorning10.mp4",
        "/static/video/goodmorning/goodmorning11.mp4",
        "/static/video/goodmorning/goodmorning12.mp4",
        "/static/video/goodmorning/goodmorning13.mp4"
      ];
      const randomVideo = goodMorningVideos[Math.floor(Math.random() * goodMorningVideos.length)];
      teachVideo.src = randomVideo;
    }
    // Special handling for don't understand phrase - randomize video selection
    else if(p.toLowerCase() === "don't understand") {
      const dontUnderstandVideos = [
        "/static/video/dontunderstand/dont understand.mp4",
        "/static/video/dontunderstand/dont uderstand1.mp4",
        "/static/video/dontunderstand/dont understand2.mp4"
      ];
      const randomVideo = dontUnderstandVideos[Math.floor(Math.random() * dontUnderstandVideos.length)];
      teachVideo.src = randomVideo;
    }
    // Special handling for good afternoon phrase - randomize video selection
    else if(p.toLowerCase() === "good afternoon") {
      const goodAfternoonVideos = [
        "/static/video/goodafternoon/goodafternoon.mp4",
        "/static/video/goodafternoon/goodafternoon1.mp4",
        "/static/video/goodafternoon/goodafternoon2.mp4",
        "/static/video/goodafternoon/goodafternoon3.mp4",
        "/static/video/goodafternoon/goodafternoon4.mp4",
        "/static/video/goodafternoon/goodafternoon5.mp4",
        "/static/video/goodafternoon/goodafternoon6.mp4",
        "/static/video/goodafternoon/goodafternoon7.mp4",
        "/static/video/goodafternoon/goodafternoon8.mp4"
      ];
      const randomVideo = goodAfternoonVideos[Math.floor(Math.random() * goodAfternoonVideos.length)];
      teachVideo.src = randomVideo;
    }
    // Special handling for good evening phrase - randomize video selection
    else if(p.toLowerCase() === "good evening") {
      const goodEveningVideos = [
        "/static/video/goodevening/goodevening.mp4",
        "/static/video/goodevening/goodevening1.mp4",
        "/static/video/goodevening/goodevening2.mp4",
        "/static/video/goodevening/goodevening3.mp4",
        "/static/video/goodevening/goodevening4.mp4",
        "/static/video/goodevening/goodevening5.mp4",
        "/static/video/goodevening/goodevening6.mp4",
        "/static/video/goodevening/goodevening7.mp4",
        "/static/video/goodevening/goodevening9.mp4",
        "/static/video/goodevening/goodevening10.mp4"
      ];
      const randomVideo = goodEveningVideos[Math.floor(Math.random() * goodEveningVideos.length)];
      teachVideo.src = randomVideo;
    } else {
      teachVideo.src = res.video;
    }

    teachVideo.load();
    teachSteps.innerHTML = "";
    (res.steps || []).forEach(s=>{
      const li=document.createElement("li"); li.textContent = s; teachSteps.appendChild(li);
    });
  }

  // Load first phrase by default
  fetch("/api/phrases").then(r=>r.json()).then(d=>{
    if(d.phrases && d.phrases.length > 0){
      loadTeach(d.phrases[0]);
    }
  });
</script>

{% endblock %}
